@attribute [Authorize(Policy = "AdminOnly")]
@inherits LayoutComponentBase
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject IAuthorizationService AuthorizationService
@inject IHttpClientFactory HttpClientFactory
@inject NavigationManager NavigationManager
@inject ILocalStorageService localStorageService
 
@code {
    private int activeIndex = 0;

    private void SetActiveClass(int index)
    {
        activeIndex = index;
    }

    private string GetNavItemClass(int index)
    {
        return activeIndex == index ? "active" : string.Empty;
    }

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;
        var IsAuthorized = user.Identity.IsAuthenticated && user.IsInRole("Admin");

        if (!IsAuthorized)
        {
            NavigationManager.NavigateTo("/");
        } 
        activeIndex = 0;
    }

    private async Task LogoutAsync()
    {
        await localStorageService.RemoveItemAsync("jwt");
        await localStorageService.RemoveItemAsync("refresh");

        var authProvider = (JwtAuthenticationStateProvider)AuthenticationStateProvider;
        authProvider.NotifyUserLogout();

        // Redirect to the login page
        NavigationManager.NavigateTo("/Login", true);
    }
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Skydash Admin</title>
    <link rel="stylesheet" href="../Dashboard/vendors/feather/feather.css">
    <link rel="stylesheet" href="../Dashboard/vendors/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../Dashboard/vendors/datatables.net-bs5/dataTables.bootstrap5.css">
    <link rel="stylesheet" href="../Dashboard/vendors/ti-icons/css/themify-icons.css">
    <link rel="stylesheet" type="text/css" href="../Dashboard/js/select.dataTables.min.css">
    <link rel="stylesheet" href="../Dashboard/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body>
    <div class="container-scroller">
        <div class="row p-0 m-0 proBanner" id="proBanner">
            <div class="col-md-12 p-0 m-0">
                <div class="card-body card-body-padding px-3 d-flex align-items-center justify-content-between">
                    <div class="nav_logo">
                        <a href="/">
                            <img src="../Assets/logo-white.png" alt="logo" class="nav_logo-dark" />
                        </a>
                    </div>
                    <div class="d-flex align-items-center justify-content-center p-1 rounded m-1">
                        <div class="dropdown m-2">
                            <a class="dropdown-toggle text-white" href="#" data-bs-toggle="dropdown"
                                id="profileDropdown">
                                <i class="fa-solid fa-user"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
                                <a class="dropdown-item">
                                    <i class="fa-solid fa-gear"></i> Settings
                                </a>
                                <a class="dropdown-item" @onclick="() => LogoutAsync()">
                                    <i class="fa-solid fa-right-from-bracket"></i> Logout
                                </a>
                            </div>
                        </div>
                        <a href="/" class="text-white">
                            <i class="fa-solid fa-house"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid page-body-wrapper">
        <nav class="sidebar" id="sidebar">
            <ul class="nav">
                <li class="nav-item">
                    <NavLink class="nav-link text-gray border-1 p-3 m-2" href="/DashBoardMain" Match="NavLinkMatch.All">
                        <i class="icon-grid menu-icon"></i>
                        <span class="menu-title">Dashboard</span>
                    </NavLink>
                </li>
                <li class="nav-item">
                    <NavLink class="nav-link text-gray border-1 p-3 m-2" href="/DashboardUsers">
                        <i class="icon-head menu-icon"></i>
                        <span class="menu-title">Users List</span>
                    </NavLink>
                </li>
                @* <li class="nav-item">
                    <NavLink class="nav-link text-gray border-1 p-3 m-2" href="/">
                        <i class="icon-paper menu-icon"></i>
                        <span class="menu-title">Documentation</span>
                    </NavLink>
                </li> *@
            </ul>
        </nav>



        @Body
    </div>

    <script src="../Dashboard/vendors/js/vendor.bundle.base.js"></script>
    <script src="../Dashboard/vendors/chart.js/chart.umd.js"></script>
    <script src="../Dashboard/vendors/datatables.net/jquery.dataTables.js"></script>
    <script src="../Dashboard/vendors/datatables.net-bs5/dataTables.bootstrap5.js"></script>
    <script src="../Dashboard/js/dataTables.select.min.js"></script>
    <script src="../Dashboard/js/off-canvas.js"></script>
    <script src="../Dashboard/js/template.js"></script>
    <script src="../Dashboard/js/settings.js"></script>
    <script src="../Dashboard/js/todolist.js"></script>
    <script src="../Dashboard/js/jquery.cookie.js" type="text/javascript"></script>
    <script src="../Dashboard/js/dashboard.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
